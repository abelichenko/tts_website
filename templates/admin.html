{% extends "base.html" %}

{% block title %}–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - TTS Website{% endblock %}

{% block content %}
<div class="admin-panel">
    <h1>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>

    <div class="stats">
        <div class="stat-card">
            <h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <p class="stat-number">{{ total_users }}</p>
        </div>
        <div class="stat-card">
            <h3>üéµ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π</h3>
            <p class="stat-number">{{ total_conversions }}</p>
        </div>
    </div>

    <div class="grant-tokens">
        <h2>üí∞ –í—ã–¥–∞—Ç—å —Ç–æ–∫–µ–Ω—ã</h2>

        <form method="POST" action="">
            {{ form.hidden_tag() }}

            <div class="form-row">
                <div class="form-group">
                    {{ form.email.label }}
                    {{ form.email(class="form-control", placeholder="user@example.com") }}
                    {% if form.email.errors %}
                        <div class="error">{{ form.email.errors[0] }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    {{ form.tokens.label }}
                    {{ form.tokens(class="form-control", placeholder="100") }}
                    {% if form.tokens.errors %}
                        <div class="error">{{ form.tokens.errors[0] }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="form-group">
                {{ form.note.label }}
                {{ form.note(class="form-control", placeholder="–ü—Ä–∏—á–∏–Ω–∞ –≤—ã–¥–∞—á–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)") }}
            </div>

            <button type="submit" class="btn btn-primary">–í—ã–¥–∞—Ç—å —Ç–æ–∫–µ–Ω—ã</button>
        </form>
    </div>

    <div class="grant-admin">
        <h2>üëë –í—ã–¥–∞—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å</h2>

        <form method="POST" action="">
            {{ admin_form.hidden_tag() }}

            <div class="form-group">
                {{ admin_form.email.label }}
                {{ admin_form.email(class="form-control", placeholder="user@example.com") }}
                {% if admin_form.email.errors %}
                    <div class="error">{{ admin_form.email.errors[0] }}</div>
                {% endif %}
            </div>

            <button type="submit" name="grant_admin" class="btn btn-primary">–í—ã–¥–∞—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å</button>
        </form>
    </div>

    <div class="users-list">
        <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
        <table class="users-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>–¢–æ–∫–µ–Ω–æ–≤</th>
                    <th>–ê–¥–º–∏–Ω</th>
                    <th>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.email }}</td>
                    <td><strong>{{ user.tokens }}</strong></td>
                    <td>{% if user.is_admin %}‚úÖ{% else %}‚ùå{% endif %}</td>
                    <td>{{ user.created_at.strftime('%d.%m.%Y') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="transactions">
        <h2>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h2>
        <table class="transactions-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–¢–æ–∫–µ–Ω—ã</th>
                    <th>–¢–∏–ø</th>
                    <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for trans in recent_transactions %}
                <tr>
                    <td>{{ trans.created_at.strftime('%d.%m %H:%M') }}</td>
                    <td>{{ trans.user.email }}</td>
                    <td class="{% if trans.amount > 0 %}positive{% else %}negative{% endif %}">
                        {% if trans.amount > 0 %}+{% endif %}{{ trans.amount }}
                    </td>
                    <td>
                        {% if trans.transaction_type == 'grant' %}üì• –í—ã–¥–∞–Ω–æ
                        {% elif trans.transaction_type == 'use' %}üì§ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ
                        {% else %}{{ trans.transaction_type }}
                        {% endif %}
                    </td>
                    <td>{{ trans.note or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}